"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = exports.WeightType = exports.VehicleStatus = exports.VehicleArrivalPurpose = void 0;
const aws_sdk_1 = require("aws-sdk");
const opensearch_1 = require("@opensearch-project/opensearch");
const ES_HOST = '127.0.0.1';
const ES_PORT = 9200;
const esClient = new opensearch_1.Client({
    node: `http://${ES_HOST}:${ES_PORT}`,
});
var VehicleArrivalPurpose;
(function (VehicleArrivalPurpose) {
    VehicleArrivalPurpose["ARREST"] = "ARREST";
    VehicleArrivalPurpose["CARGO_EXTRACTION"] = "CARGO_EXTRACTION";
    VehicleArrivalPurpose["CARGO_IMPORT"] = "CARGO_IMPORT";
    VehicleArrivalPurpose["PARKING"] = "PARKING";
    VehicleArrivalPurpose["PARKING_WITH_CARGO"] = "PARKING_WITH_CARGO";
    VehicleArrivalPurpose["WEIGHIN"] = "WEIGHIN";
})(VehicleArrivalPurpose = exports.VehicleArrivalPurpose || (exports.VehicleArrivalPurpose = {}));
var VehicleStatus;
(function (VehicleStatus) {
    VehicleStatus["ARRIVED"] = "ARRIVED";
    VehicleStatus["DEPARTED"] = "DEPARTED";
})(VehicleStatus = exports.VehicleStatus || (exports.VehicleStatus = {}));
var WeightType;
(function (WeightType) {
    WeightType["GROSS"] = "GROSS";
    WeightType["TARE"] = "TARE";
})(WeightType = exports.WeightType || (exports.WeightType = {}));
async function handler(event) {
    const bulkData = [];
    for (let record of event.Records) {
        const { eventSourceARN, eventName, dynamodb } = record;
        if (!eventSourceARN || !eventName || !dynamodb)
            continue;
        const match = eventSourceARN.match(/.+:table\/([^"]+)\/stream/);
        const { NewImage, OldImage, Keys } = dynamodb;
        if (!match)
            continue;
        const [, tableName] = match;
        console.log(`Event from ${tableName}`);
        // INSERT event
        if (eventName === 'INSERT') {
            if (!NewImage)
                continue;
            const newVehicle = aws_sdk_1.DynamoDB.Converter.unmarshall(NewImage);
            bulkData.push(...createIndex(getHotIndex(tableName), newVehicle));
        }
        // Update event
        if (eventName === 'MODIFY') {
            if (!NewImage || !OldImage)
                continue;
            const newVehicle = aws_sdk_1.DynamoDB.Converter.unmarshall(NewImage);
            const oldVehicle = aws_sdk_1.DynamoDB.Converter.unmarshall(OldImage);
            if (newVehicle.status === VehicleStatus.DEPARTED &&
                oldVehicle.status === VehicleStatus.ARRIVED) {
                bulkData.push(deleteIndex(getHotIndex(tableName), newVehicle.id));
                bulkData.push(...createIndex(getColdIndex(tableName), newVehicle));
            }
            else {
                bulkData.push(...updateIndex(getVehicleIndex(newVehicle, tableName), newVehicle));
            }
        }
    }
    const data = await esClient.bulk({ body: bulkData, refresh: true });
    printResponse(data);
    function updateIndex(index, data) {
        return [
            {
                delete: { _index: index, _id: data.id },
            },
            { doc: data },
        ];
    }
    function deleteIndex(index, id) {
        return {
            delete: { _index: index, _id: id },
        };
    }
    /*
    index: If the document exists, replaces the document and increments the version.
    create: Indexes the specified document if it does not already exist.
    */
    function createIndex(index, data) {
        return [
            {
                index: { _index: index, _id: data.id },
            },
            data,
        ];
    }
    function getVehicleIndex(vehicle, tableName) {
        if (vehicle.status === VehicleStatus.DEPARTED) {
            return getColdIndex(tableName);
        }
        return getHotIndex(tableName);
    }
    function getColdIndex(tableName) {
        return `${tableName.toLowerCase()}-cold`;
    }
    function getHotIndex(tableName) {
        return `${tableName.toLowerCase()}-hot`;
    }
}
exports.handler = handler;
function printResponse(response) {
    console.log(JSON.stringify(response, null, 2));
}
const hotArrivedCargoImport = {
    ApproximateCreationDateTime: 1479499740,
    Keys: {
        id: {
            S: '20211028_05KG711ABJ',
        },
    },
    NewImage: {
        id: {
            S: '20211028_05KG711ABJ',
        },
        arrivalPurpose: {
            S: 'CARGO_IMPORT',
        },
        netWeight: {
            N: '0',
        },
        trailerPlateNumber: {
            S: '05KG997PA',
        },
        status: {
            S: 'ARRIVED',
        },
        borderCheckpoint: {
            S: 'Torugart',
        },
        operator: {
            M: {
                id: {
                    S: 'fab1a253-4b7e-4269-adbf-b3c141d99dac',
                },
                organization: {
                    M: {
                        id: {
                            S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                        },
                    },
                },
            },
        },
        driver: {
            M: {
                name: {
                    S: 'Токтобаев М',
                },
            },
        },
        tareWeight: {
            N: '0',
        },
        departureCountry: {
            S: 'China',
        },
        organization: {
            M: {
                id: {
                    S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                },
            },
        },
        weightType: {
            S: 'GROSS',
        },
        vehiclePlateNumber: {
            S: '05KG711ABJ',
        },
        grossWeight: {
            N: '0',
        },
        arrivalDate: {
            N: '1635413689730',
        },
    },
    SequenceNumber: '13021600000000001596893679',
    SizeBytes: 112,
    StreamViewType: 'NEW_AND_OLD_IMAGES',
};
const createData = {
    ApproximateCreationDateTime: 1479499740,
    Keys: {
        id: {
            S: 'maks',
        },
    },
    NewImage: {
        id: {
            S: 'maks',
        },
        arrivalPurpose: {
            S: 'CARGO_IMPORT',
        },
        netWeight: {
            N: '0',
        },
        trailerPlateNumber: {
            S: '05KG997PA',
        },
        status: {
            S: 'ARRIVED',
        },
        borderCheckpoint: {
            S: 'Torugart',
        },
        operator: {
            M: {
                id: {
                    S: 'fab1a253-4b7e-4269-adbf-b3c141d99dac',
                },
                organization: {
                    M: {
                        id: {
                            S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                        },
                    },
                },
            },
        },
        driver: {
            M: {
                name: {
                    S: 'Токтобаев М',
                },
            },
        },
        tareWeight: {
            N: '0',
        },
        departureCountry: {
            S: 'China',
        },
        organization: {
            M: {
                id: {
                    S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                },
            },
        },
        weightType: {
            S: 'GROSS',
        },
        vehiclePlateNumber: {
            S: '05KG711ABJ',
        },
        grossWeight: {
            N: '0',
        },
        arrivalDate: {
            N: '1635413689730',
        },
    },
    SequenceNumber: '13021600000000001596893679',
    SizeBytes: 112,
    StreamViewType: 'NEW_AND_OLD_IMAGES',
};
const coldCargoImport = {
    Keys: {
        id: {
            S: '20211028_05KG711ABJ',
        },
    },
    NewImage: {
        id: {
            S: '20211028_05KG711ABJ',
        },
        arrivalPurpose: {
            S: 'CARGO_IMPORT',
        },
        netWeight: {
            N: '0',
        },
        trailerPlateNumber: {
            S: '05KG997PA',
        },
        status: {
            S: 'DEPARTED',
        },
        borderCheckpoint: {
            S: 'Torugart',
        },
        operator: {
            M: {
                id: {
                    S: 'fab1a253-4b7e-4269-adbf-b3c141d99dac',
                },
                organization: {
                    M: {
                        id: {
                            S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                        },
                    },
                },
            },
        },
        driver: {
            M: {
                name: {
                    S: 'Токтобаев М',
                },
            },
        },
        tareWeight: {
            N: '0',
        },
        departureCountry: {
            S: 'China',
        },
        organization: {
            M: {
                id: {
                    S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                },
            },
        },
        weightType: {
            S: 'GROSS',
        },
        vehiclePlateNumber: {
            S: '05KG711ABJ',
        },
        grossWeight: {
            N: '0',
        },
        arrivalDate: {
            N: '1635413689730',
        },
    },
    OldImage: {
        id: {
            S: '20211028_05KG711ABJ',
        },
        arrivalPurpose: {
            S: 'CARGO_IMPORT',
        },
        netWeight: {
            N: '0',
        },
        trailerPlateNumber: {
            S: '05KG997PA',
        },
        status: {
            S: 'ARRIVED',
        },
        borderCheckpoint: {
            S: 'Torugart',
        },
        operator: {
            M: {
                id: {
                    S: 'fab1a253-4b7e-4269-adbf-b3c141d99dac',
                },
                organization: {
                    M: {
                        id: {
                            S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                        },
                    },
                },
            },
        },
        driver: {
            M: {
                name: {
                    S: 'Токтобаев М',
                },
            },
        },
        tareWeight: {
            N: '0',
        },
        departureCountry: {
            S: 'China',
        },
        organization: {
            M: {
                id: {
                    S: '61ba7c84-1ad5-4a37-88a9-15892b58be22',
                },
            },
        },
        weightType: {
            S: 'GROSS',
        },
        vehiclePlateNumber: {
            S: '05KG711ABJ',
        },
        grossWeight: {
            N: '0',
        },
        arrivalDate: {
            N: '1635413689730',
        },
    },
    SequenceNumber: '13021600000000001596893679',
    SizeBytes: 112,
    StreamViewType: 'NEW_AND_OLD_IMAGES',
};
const createRecord = {
    eventID: '7de3041dd709b024af6f29e4fa13d34c',
    eventName: 'INSERT',
    eventVersion: '1.1',
    eventSource: 'aws:dynamodb',
    awsRegion: 'us-west-2',
    dynamodb: hotArrivedCargoImport,
    eventSourceARN: `arn:aws:dynamodb:region:123456789012:table/Vehicles/stream/2016-11-16T20:42:48.104`,
};
const createRecordData = {
    eventID: '7de3041dd709b024af6f29e4fa13d34c',
    eventName: 'INSERT',
    eventVersion: '1.1',
    eventSource: 'aws:dynamodb',
    awsRegion: 'us-west-2',
    dynamodb: createData,
    eventSourceARN: `arn:aws:dynamodb:region:123456789012:table/Vehicles/stream/2016-11-16T20:42:48.104`,
};
const updateRecord = {
    eventID: '7de3041dd709b024af6f29e4fa13d3js',
    eventName: 'MODIFY',
    eventVersion: '1.1',
    eventSource: 'aws:dynamodb',
    awsRegion: 'us-west-2',
    dynamodb: coldCargoImport,
    eventSourceARN: `arn:aws:dynamodb:region:123456789012:table/Vehicles/stream/2016-11-16T20:42:48.104`,
};
async function doJob() {
    const data = {
        Records: [createRecord, createRecordData, updateRecord],
    };
    await handler(data);
}
doJob();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXhNYXBwZXJCdWxrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW5kZXhNYXBwZXJCdWxrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLHFDQUFtQztBQUVuQywrREFJd0M7QUFFeEMsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDO0FBQzVCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQztBQUVyQixNQUFNLFFBQVEsR0FBRyxJQUFJLG1CQUFNLENBQUM7SUFDMUIsSUFBSSxFQUFFLFVBQVUsT0FBTyxJQUFJLE9BQU8sRUFBRTtDQUNyQyxDQUFDLENBQUM7QUFFSCxJQUFZLHFCQU9YO0FBUEQsV0FBWSxxQkFBcUI7SUFDL0IsMENBQWlCLENBQUE7SUFDakIsOERBQXFDLENBQUE7SUFDckMsc0RBQTZCLENBQUE7SUFDN0IsNENBQW1CLENBQUE7SUFDbkIsa0VBQXlDLENBQUE7SUFDekMsNENBQW1CLENBQUE7QUFDckIsQ0FBQyxFQVBXLHFCQUFxQixHQUFyQiw2QkFBcUIsS0FBckIsNkJBQXFCLFFBT2hDO0FBRUQsSUFBWSxhQUdYO0FBSEQsV0FBWSxhQUFhO0lBQ3ZCLG9DQUFtQixDQUFBO0lBQ25CLHNDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFIVyxhQUFhLEdBQWIscUJBQWEsS0FBYixxQkFBYSxRQUd4QjtBQUVELElBQVksVUFHWDtBQUhELFdBQVksVUFBVTtJQUNwQiw2QkFBZSxDQUFBO0lBQ2YsMkJBQWEsQ0FBQTtBQUNmLENBQUMsRUFIVyxVQUFVLEdBQVYsa0JBQVUsS0FBVixrQkFBVSxRQUdyQjtBQTZDTSxLQUFLLFVBQVUsT0FBTyxDQUFDLEtBQTBCO0lBQ3RELE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUVwQixLQUFLLElBQUksTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUU7UUFDaEMsTUFBTSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEdBQUcsTUFBTSxDQUFDO1FBQ3ZELElBQUks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RSxLQUFLO0lBQ25CLFdBQVcsRUFBRSxjQUFjO0lBQzNCLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLFFBQVEsRUFBRSxxQkFBcUI7SUFDL0IsY0FBYyxFQUFFLG9GQUFvRjtDQUNyRyxDQUFDO0FBRUYsTUFBTSxnQkFBZ0IsR0FBbUI7SUFDdkMsT0FBTyxFQUFFLGtDQUFrQztJQUMzQyxTQUFTLEVBQUUsUUFBUTtJQUNuQixZQUFZLEVBQUUsS0FBSztJQUNuQixXQUFXLEVBQUUsY0FBYztJQUMzQixTQUFTLEVBQUUsV0FBVztJQUN0QixRQUFRLEVBQUUsVUFBVTtJQUNwQixjQUFjLEVBQUUsb0ZBQW9GO0NBQ3JHLENBQUM7QUFFRixNQUFNLFlBQVksR0FBbUI7SUFDbkMsT0FBTyxFQUFFLGtDQUFrQztJQUMzQyxTQUFTLEVBQUUsUUFBUTtJQUNuQixZQUFZLEVBQUUsS0FBSztJQUNuQixXQUFXLEVBQUUsY0FBYztJQUMzQixTQUFTLEVBQUUsV0FBVztJQUN0QixRQUFRLEVBQUUsZUFBZTtJQUN6QixjQUFjLEVBQUUsb0ZBQW9GO0NBQ3JHLENBQUM7QUFFRixLQUFLLFVBQVUsS0FBSztJQUNsQixNQUFNLElBQUksR0FBd0I7UUFDaEMsT0FBTyxFQUFFLENBQUMsWUFBWSxFQUFFLGdCQUFnQixFQUFFLFlBQVksQ0FBQztLQUN4RCxDQUFDO0lBRUYsTUFBTSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdEIsQ0FBQztBQUVELEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogRXh0ZXJuYWwgZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBEeW5hbW9EQlJlY29yZCwgRHluYW1vREJTdHJlYW1FdmVudCwgU3RyZWFtUmVjb3JkIH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBEeW5hbW9EQiB9IGZyb20gJ2F3cy1zZGsnO1xuXG5pbXBvcnQge1xuICBDbGllbnQsXG4gIENvbm5lY3Rpb24sXG4gIFJlcXVlc3RQYXJhbXMsXG59IGZyb20gJ0BvcGVuc2VhcmNoLXByb2plY3Qvb3BlbnNlYXJjaCc7XG5cbmNvbnN0IEVTX0hPU1QgPSAnMTI3LjAuMC4xJztcbmNvbnN0IEVTX1BPUlQgPSA5MjAwO1xuXG5jb25zdCBlc0NsaWVudCA9IG5ldyBDbGllbnQoe1xuICBub2RlOiBgaHR0cDovLyR7RVNfSE9TVH06JHtFU19QT1JUfWAsXG59KTtcblxuZXhwb3J0IGVudW0gVmVoaWNsZUFycml2YWxQdXJwb3NlIHtcbiAgQVJSRVNUID0gJ0FSUkVTVCcsXG4gIENBUkdPX0VYVFJBQ1RJT04gPSAnQ0FSR09fRVhUUkFDVElPTicsXG4gIENBUkdPX0lNUE9SVCA9ICdDQVJHT19JTVBPUlQnLFxuICBQQVJLSU5HID0gJ1BBUktJTkcnLFxuICBQQVJLSU5HX1dJVEhfQ0FSR08gPSAnUEFSS0lOR19XSVRIX0NBUkdPJyxcbiAgV0VJR0hJTiA9ICdXRUlHSElOJyxcbn1cblxuZXhwb3J0IGVudW0gVmVoaWNsZVN0YXR1cyB7XG4gIEFSUklWRUQgPSAnQVJSSVZFRCcsXG4gIERFUEFSVEVEID0gJ0RFUEFSVEVEJyxcbn1cblxuZXhwb3J0IGVudW0gV2VpZ2h0VHlwZSB7XG4gIEdST1NTID0gJ0dST1NTJyxcbiAgVEFSRSA9ICdUQVJFJyxcbn1cbmV4cG9ydCB0eXBlIEV4dGVybmFsVXNlciA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICBwaG9uZT86IHN0cmluZztcbiAgcm9sZT86IHN0cmluZztcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3JnYW5pemF0aW9uIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBVc2VyID0ge1xuICBpZDogSUQ7XG4gIGZpcnN0TmFtZTogc3RyaW5nO1xuICBsYXN0TmFtZTogc3RyaW5nO1xuICBvcmdhbml6YXRpb246IE9yZ2FuaXphdGlvbjtcbiAgcGhvbmU6IHN0cmluZztcbiAgcm9sZTogc3RyaW5nO1xuICBqb2luRGF0ZTogbnVtYmVyO1xufTtcblxudHlwZSBJRCA9IHN0cmluZztcblxuZXhwb3J0IHR5cGUgVmVoaWNsZSA9IHtcbiAgaWQ6IElEO1xuICBhY3RGb3JtTnVtYmVyPzogc3RyaW5nO1xuICBhcnJpdmFsRGF0ZTogbnVtYmVyO1xuICBhcnJpdmFsUHVycG9zZTogVmVoaWNsZUFycml2YWxQdXJwb3NlO1xuICBib3JkZXJDaGVja3BvaW50Pzogc3RyaW5nO1xuICBkZXBhcnR1cmVDb3VudHJ5OiBzdHJpbmc7XG4gIGRlcGFydHVyZURhdGU/OiBudW1iZXI7XG4gIGRyaXZlcj86IEV4dGVybmFsVXNlcjtcbiAgZ3Jvc3NXZWlnaHQ6IG51bWJlcjtcbiAgbmV0V2VpZ2h0PzogbnVtYmVyO1xuICBvcmdhbml6YXRpb24/OiBPcmdhbml6YXRpb247XG4gIHJlcHJlc2VudGF0aXZlPzogRXh0ZXJuYWxVc2VyO1xuICBzdGF0dXM6IFZlaGljbGVTdGF0dXM7XG4gIHRhcmVXZWlnaHQ/OiBudW1iZXI7XG4gIHRyYWlsZXJQbGF0ZU51bWJlcj86IHN0cmluZztcbiAgb3BlcmF0b3I6IFVzZXI7XG4gIHZlaGljbGVQbGF0ZU51bWJlcjogc3RyaW5nO1xuICB3ZWlnaHRUeXBlOiBXZWlnaHRUeXBlO1xufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQ6IER5bmFtb0RCU3RyZWFtRXZlbnQpIHtcbiAgY29uc3QgYnVsa0RhdGEgPSBbXTtcblxuICBmb3IgKGxldCByZWNvcmQgb2YgZXZlbnQuUmVjb3Jkcykge1xuICAgIGNvbnN0IHsgZXZlbnRTb3VyY2VBUk4sIGV2ZW50TmFtZSwgZHluYW1vZGIgfSA9IHJlY29yZDtcbiAgICBpZiAoIWV2ZW50U291cmNlQVJOIHx8ICFldmVudE5hbWUgfHwgIWR5bmFtb2RiKSBjb250aW51ZTtcblxuICAgIGNvbnN0IG1hdGNoID0gZXZlbnRTb3VyY2VBUk4ubWF0Y2goLy4rOnRhYmxlXFwvKFteXCJdKylcXC9zdHJlYW0vKTtcbiAgICBjb25zdCB7IE5ld0ltYWdlLCBPbGRJbWFnZSwgS2V5cyB9ID0gZHluYW1vZGI7XG5cbiAgICBpZiAoIW1hdGNoKSBjb250aW51ZTtcblxuICAgIGNvbnN0IFssIHRhYmxlTmFtZV0gPSBtYXRjaDtcbiAgICBjb25zb2xlLmxvZyhgRXZlbnQgZnJvbSAke3RhYmxlTmFtZX1gKTtcblxuICAgIC8vIElOU0VSVCBldmVudFxuICAgIGlmIChldmVudE5hbWUgPT09ICdJTlNFUlQnKSB7XG4gICAgICBpZiAoIU5ld0ltYWdlKSBjb250aW51ZTtcblxuICAgICAgY29uc3QgbmV3VmVoaWNsZSA9IER5bmFtb0RCLkNvbnZlcnRlci51bm1hcnNoYWxsKE5ld0ltYWdlKSBhcyBWZWhpY2xlO1xuXG4gICAgICBidWxrRGF0YS5wdXNoKC4uLmNyZWF0ZUluZGV4KGdldEhvdEluZGV4KHRhYmxlTmFtZSksIG5ld1ZlaGljbGUpKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgZXZlbnRcbiAgICBpZiAoZXZlbnROYW1lID09PSAnTU9ESUZZJykge1xuICAgICAgaWYgKCFOZXdJbWFnZSB8fCAhT2xkSW1hZ2UpIGNvbnRpbnVlO1xuXG4gICAgICBjb25zdCBuZXdWZWhpY2xlID0gRHluYW1vREIuQ29udmVydGVyLnVubWFyc2hhbGwoTmV3SW1hZ2UpIGFzIFZlaGljbGU7XG4gICAgICBjb25zdCBvbGRWZWhpY2xlID0gRHluYW1vREIuQ29udmVydGVyLnVubWFyc2hhbGwoT2xkSW1hZ2UpIGFzIFZlaGljbGU7XG5cbiAgICAgIGlmIChcbiAgICAgICAgbmV3VmVoaWNsZS5zdGF0dXMgPT09IFZlaGljbGVTdGF0dXMuREVQQVJURUQgJiZcbiAgICAgICAgb2xkVmVoaWNsZS5zdGF0dXMgPT09IFZlaGljbGVTdGF0dXMuQVJSSVZFRFxuICAgICAgKSB7XG4gICAgICAgIGJ1bGtEYXRhLnB1c2goZGVsZXRlSW5kZXgoZ2V0SG90SW5kZXgodGFibGVOYW1lKSwgbmV3VmVoaWNsZS5pZCkpO1xuICAgICAgICBidWxrRGF0YS5wdXNoKC4uLmNyZWF0ZUluZGV4KGdldENvbGRJbmRleCh0YWJsZU5hbWUpLCBuZXdWZWhpY2xlKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidWxrRGF0YS5wdXNoKFxuICAgICAgICAgIC4uLnVwZGF0ZUluZGV4KGdldFZlaGljbGVJbmRleChuZXdWZWhpY2xlLCB0YWJsZU5hbWUpLCBuZXdWZWhpY2xlKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBlc0NsaWVudC5idWxrKHsgYm9keTogYnVsa0RhdGEsIHJlZnJlc2g6IHRydWUgfSk7XG4gIHByaW50UmVzcG9uc2UoZGF0YSk7XG5cbiAgZnVuY3Rpb24gdXBkYXRlSW5kZXgoaW5kZXg6IHN0cmluZywgZGF0YTogVmVoaWNsZSk6IGFueSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgZGVsZXRlOiB7IF9pbmRleDogaW5kZXgsIF9pZDogZGF0YS5pZCB9LFxuICAgICAgfSxcbiAgICAgIHsgZG9jOiBkYXRhIH0sXG4gICAgXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlbGV0ZUluZGV4KGluZGV4OiBzdHJpbmcsIGlkOiBzdHJpbmcpOiB7fSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlbGV0ZTogeyBfaW5kZXg6IGluZGV4LCBfaWQ6IGlkIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qXG4gIGluZGV4OiBJZiB0aGUgZG9jdW1lbnQgZXhpc3RzLCByZXBsYWNlcyB0aGUgZG9jdW1lbnQgYW5kIGluY3JlbWVudHMgdGhlIHZlcnNpb24uXG4gIGNyZWF0ZTogSW5kZXhlcyB0aGUgc3BlY2lmaWVkIGRvY3VtZW50IGlmIGl0IGRvZXMgbm90IGFscmVhZHkgZXhpc3QuXG4gICovXG4gIGZ1bmN0aW9uIGNyZWF0ZUluZGV4KGluZGV4OiBzdHJpbmcsIGRhdGE6IFZlaGljbGUpOiBhbnkge1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIGluZGV4OiB7IF9pbmRleDogaW5kZXgsIF9pZDogZGF0YS5pZCB9LFxuICAgICAgfSxcbiAgICAgIGRhdGEsXG4gICAgXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFZlaGljbGVJbmRleCh2ZWhpY2xlOiBWZWhpY2xlLCB0YWJsZU5hbWU6IHN0cmluZykge1xuICAgIGlmICh2ZWhpY2xlLnN0YXR1cyA9PT0gVmVoaWNsZVN0YXR1cy5ERVBBUlRFRCkge1xuICAgICAgcmV0dXJuIGdldENvbGRJbmRleCh0YWJsZU5hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBnZXRIb3RJbmRleCh0YWJsZU5hbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Q29sZEluZGV4KHRhYmxlTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGAke3RhYmxlTmFtZS50b0xvd2VyQ2FzZSgpfS1jb2xkYDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEhvdEluZGV4KHRhYmxlTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGAke3RhYmxlTmFtZS50b0xvd2VyQ2FzZSgpfS1ob3RgO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByaW50UmVzcG9uc2UocmVzcG9uc2U6IGFueSkge1xuICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXNwb25zZSwgbnVsbCwgMikpO1xufVxuXG5jb25zdCBob3RBcnJpdmVkQ2FyZ29JbXBvcnQ6IFN0cmVhbVJlY29yZCA9IHtcbiAgQXBwcm94aW1hdGVDcmVhdGlvbkRhdGVUaW1lOiAxNDc5NDk5NzQwLFxuICBLZXlzOiB7XG4gICAgaWQ6IHtcbiAgICAgIFM6ICcyMDIxMTAyOF8wNUtHNzExQUJKJyxcbiAgICB9LFxuICB9LFxuICBOZXdJbWFnZToge1xuICAgIGlkOiB7XG4gICAgICBTOiAnMjAyMTEwMjhfMDVLRzcxMUFCSicsXG4gICAgfSxcbiAgICBhcnJpdmFsUHVycG9zZToge1xuICAgICAgUzogJ0NBUkdPX0lNUE9SVCcsXG4gICAgfSxcbiAgICBuZXRXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIHRyYWlsZXJQbGF0ZU51bWJlcjoge1xuICAgICAgUzogJzA1S0c5OTdQQScsXG4gICAgfSxcbiAgICBzdGF0dXM6IHtcbiAgICAgIFM6ICdBUlJJVkVEJyxcbiAgICB9LFxuICAgIGJvcmRlckNoZWNrcG9pbnQ6IHtcbiAgICAgIFM6ICdUb3J1Z2FydCcsXG4gICAgfSxcbiAgICBvcGVyYXRvcjoge1xuICAgICAgTToge1xuICAgICAgICBpZDoge1xuICAgICAgICAgIFM6ICdmYWIxYTI1My00YjdlLTQyNjktYWRiZi1iM2MxNDFkOTlkYWMnLFxuICAgICAgICB9LFxuICAgICAgICBvcmdhbml6YXRpb246IHtcbiAgICAgICAgICBNOiB7XG4gICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICBTOiAnNjFiYTdjODQtMWFkNS00YTM3LTg4YTktMTU4OTJiNThiZTIyJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBkcml2ZXI6IHtcbiAgICAgIE06IHtcbiAgICAgICAgbmFtZToge1xuICAgICAgICAgIFM6ICfQotC+0LrRgtC+0LHQsNC10LIg0JwnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIHRhcmVXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIGRlcGFydHVyZUNvdW50cnk6IHtcbiAgICAgIFM6ICdDaGluYScsXG4gICAgfSxcbiAgICBvcmdhbml6YXRpb246IHtcbiAgICAgIE06IHtcbiAgICAgICAgaWQ6IHtcbiAgICAgICAgICBTOiAnNjFiYTdjODQtMWFkNS00YTM3LTg4YTktMTU4OTJiNThiZTIyJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB3ZWlnaHRUeXBlOiB7XG4gICAgICBTOiAnR1JPU1MnLFxuICAgIH0sXG4gICAgdmVoaWNsZVBsYXRlTnVtYmVyOiB7XG4gICAgICBTOiAnMDVLRzcxMUFCSicsXG4gICAgfSxcbiAgICBncm9zc1dlaWdodDoge1xuICAgICAgTjogJzAnLFxuICAgIH0sXG4gICAgYXJyaXZhbERhdGU6IHtcbiAgICAgIE46ICcxNjM1NDEzNjg5NzMwJyxcbiAgICB9LFxuICB9LFxuICBTZXF1ZW5jZU51bWJlcjogJzEzMDIxNjAwMDAwMDAwMDAxNTk2ODkzNjc5JyxcbiAgU2l6ZUJ5dGVzOiAxMTIsXG4gIFN0cmVhbVZpZXdUeXBlOiAnTkVXX0FORF9PTERfSU1BR0VTJyxcbn07XG5cbmNvbnN0IGNyZWF0ZURhdGE6IFN0cmVhbVJlY29yZCA9IHtcbiAgQXBwcm94aW1hdGVDcmVhdGlvbkRhdGVUaW1lOiAxNDc5NDk5NzQwLFxuICBLZXlzOiB7XG4gICAgaWQ6IHtcbiAgICAgIFM6ICdtYWtzJyxcbiAgICB9LFxuICB9LFxuICBOZXdJbWFnZToge1xuICAgIGlkOiB7XG4gICAgICBTOiAnbWFrcycsXG4gICAgfSxcbiAgICBhcnJpdmFsUHVycG9zZToge1xuICAgICAgUzogJ0NBUkdPX0lNUE9SVCcsXG4gICAgfSxcbiAgICBuZXRXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIHRyYWlsZXJQbGF0ZU51bWJlcjoge1xuICAgICAgUzogJzA1S0c5OTdQQScsXG4gICAgfSxcbiAgICBzdGF0dXM6IHtcbiAgICAgIFM6ICdBUlJJVkVEJyxcbiAgICB9LFxuICAgIGJvcmRlckNoZWNrcG9pbnQ6IHtcbiAgICAgIFM6ICdUb3J1Z2FydCcsXG4gICAgfSxcbiAgICBvcGVyYXRvcjoge1xuICAgICAgTToge1xuICAgICAgICBpZDoge1xuICAgICAgICAgIFM6ICdmYWIxYTI1My00YjdlLTQyNjktYWRiZi1iM2MxNDFkOTlkYWMnLFxuICAgICAgICB9LFxuICAgICAgICBvcmdhbml6YXRpb246IHtcbiAgICAgICAgICBNOiB7XG4gICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICBTOiAnNjFiYTdjODQtMWFkNS00YTM3LTg4YTktMTU4OTJiNThiZTIyJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBkcml2ZXI6IHtcbiAgICAgIE06IHtcbiAgICAgICAgbmFtZToge1xuICAgICAgICAgIFM6ICfQotC+0LrRgtC+0LHQsNC10LIg0JwnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIHRhcmVXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIGRlcGFydHVyZUNvdW50cnk6IHtcbiAgICAgIFM6ICdDaGluYScsXG4gICAgfSxcbiAgICBvcmdhbml6YXRpb246IHtcbiAgICAgIE06IHtcbiAgICAgICAgaWQ6IHtcbiAgICAgICAgICBTOiAnNjFiYTdjODQtMWFkNS00YTM3LTg4YTktMTU4OTJiNThiZTIyJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB3ZWlnaHRUeXBlOiB7XG4gICAgICBTOiAnR1JPU1MnLFxuICAgIH0sXG4gICAgdmVoaWNsZVBsYXRlTnVtYmVyOiB7XG4gICAgICBTOiAnMDVLRzcxMUFCSicsXG4gICAgfSxcbiAgICBncm9zc1dlaWdodDoge1xuICAgICAgTjogJzAnLFxuICAgIH0sXG4gICAgYXJyaXZhbERhdGU6IHtcbiAgICAgIE46ICcxNjM1NDEzNjg5NzMwJyxcbiAgICB9LFxuICB9LFxuICBTZXF1ZW5jZU51bWJlcjogJzEzMDIxNjAwMDAwMDAwMDAxNTk2ODkzNjc5JyxcbiAgU2l6ZUJ5dGVzOiAxMTIsXG4gIFN0cmVhbVZpZXdUeXBlOiAnTkVXX0FORF9PTERfSU1BR0VTJyxcbn07XG5cbmNvbnN0IGNvbGRDYXJnb0ltcG9ydDogU3RyZWFtUmVjb3JkID0ge1xuICBLZXlzOiB7XG4gICAgaWQ6IHtcbiAgICAgIFM6ICcyMDIxMTAyOF8wNUtHNzExQUJKJyxcbiAgICB9LFxuICB9LFxuICBOZXdJbWFnZToge1xuICAgIGlkOiB7XG4gICAgICBTOiAnMjAyMTEwMjhfMDVLRzcxMUFCSicsXG4gICAgfSxcbiAgICBhcnJpdmFsUHVycG9zZToge1xuICAgICAgUzogJ0NBUkdPX0lNUE9SVCcsXG4gICAgfSxcbiAgICBuZXRXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIHRyYWlsZXJQbGF0ZU51bWJlcjoge1xuICAgICAgUzogJzA1S0c5OTdQQScsXG4gICAgfSxcbiAgICBzdGF0dXM6IHtcbiAgICAgIFM6ICdERVBBUlRFRCcsXG4gICAgfSxcbiAgICBib3JkZXJDaGVja3BvaW50OiB7XG4gICAgICBTOiAnVG9ydWdhcnQnLFxuICAgIH0sXG4gICAgb3BlcmF0b3I6IHtcbiAgICAgIE06IHtcbiAgICAgICAgaWQ6IHtcbiAgICAgICAgICBTOiAnZmFiMWEyNTMtNGI3ZS00MjY5LWFkYmYtYjNjMTQxZDk5ZGFjJyxcbiAgICAgICAgfSxcbiAgICAgICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICAgICAgTToge1xuICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgUzogJzYxYmE3Yzg0LTFhZDUtNGEzNy04OGE5LTE1ODkyYjU4YmUyMicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgZHJpdmVyOiB7XG4gICAgICBNOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICBTOiAn0KLQvtC60YLQvtCx0LDQtdCyINCcJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB0YXJlV2VpZ2h0OiB7XG4gICAgICBOOiAnMCcsXG4gICAgfSxcbiAgICBkZXBhcnR1cmVDb3VudHJ5OiB7XG4gICAgICBTOiAnQ2hpbmEnLFxuICAgIH0sXG4gICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICBNOiB7XG4gICAgICAgIGlkOiB7XG4gICAgICAgICAgUzogJzYxYmE3Yzg0LTFhZDUtNGEzNy04OGE5LTE1ODkyYjU4YmUyMicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgd2VpZ2h0VHlwZToge1xuICAgICAgUzogJ0dST1NTJyxcbiAgICB9LFxuICAgIHZlaGljbGVQbGF0ZU51bWJlcjoge1xuICAgICAgUzogJzA1S0c3MTFBQkonLFxuICAgIH0sXG4gICAgZ3Jvc3NXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIGFycml2YWxEYXRlOiB7XG4gICAgICBOOiAnMTYzNTQxMzY4OTczMCcsXG4gICAgfSxcbiAgfSxcbiAgT2xkSW1hZ2U6IHtcbiAgICBpZDoge1xuICAgICAgUzogJzIwMjExMDI4XzA1S0c3MTFBQkonLFxuICAgIH0sXG4gICAgYXJyaXZhbFB1cnBvc2U6IHtcbiAgICAgIFM6ICdDQVJHT19JTVBPUlQnLFxuICAgIH0sXG4gICAgbmV0V2VpZ2h0OiB7XG4gICAgICBOOiAnMCcsXG4gICAgfSxcbiAgICB0cmFpbGVyUGxhdGVOdW1iZXI6IHtcbiAgICAgIFM6ICcwNUtHOTk3UEEnLFxuICAgIH0sXG4gICAgc3RhdHVzOiB7XG4gICAgICBTOiAnQVJSSVZFRCcsXG4gICAgfSxcbiAgICBib3JkZXJDaGVja3BvaW50OiB7XG4gICAgICBTOiAnVG9ydWdhcnQnLFxuICAgIH0sXG4gICAgb3BlcmF0b3I6IHtcbiAgICAgIE06IHtcbiAgICAgICAgaWQ6IHtcbiAgICAgICAgICBTOiAnZmFiMWEyNTMtNGI3ZS00MjY5LWFkYmYtYjNjMTQxZDk5ZGFjJyxcbiAgICAgICAgfSxcbiAgICAgICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICAgICAgTToge1xuICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgUzogJzYxYmE3Yzg0LTFhZDUtNGEzNy04OGE5LTE1ODkyYjU4YmUyMicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgZHJpdmVyOiB7XG4gICAgICBNOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICBTOiAn0KLQvtC60YLQvtCx0LDQtdCyINCcJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB0YXJlV2VpZ2h0OiB7XG4gICAgICBOOiAnMCcsXG4gICAgfSxcbiAgICBkZXBhcnR1cmVDb3VudHJ5OiB7XG4gICAgICBTOiAnQ2hpbmEnLFxuICAgIH0sXG4gICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICBNOiB7XG4gICAgICAgIGlkOiB7XG4gICAgICAgICAgUzogJzYxYmE3Yzg0LTFhZDUtNGEzNy04OGE5LTE1ODkyYjU4YmUyMicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgd2VpZ2h0VHlwZToge1xuICAgICAgUzogJ0dST1NTJyxcbiAgICB9LFxuICAgIHZlaGljbGVQbGF0ZU51bWJlcjoge1xuICAgICAgUzogJzA1S0c3MTFBQkonLFxuICAgIH0sXG4gICAgZ3Jvc3NXZWlnaHQ6IHtcbiAgICAgIE46ICcwJyxcbiAgICB9LFxuICAgIGFycml2YWxEYXRlOiB7XG4gICAgICBOOiAnMTYzNTQxMzY4OTczMCcsXG4gICAgfSxcbiAgfSxcbiAgU2VxdWVuY2VOdW1iZXI6ICcxMzAyMTYwMDAwMDAwMDAwMTU5Njg5MzY3OScsXG4gIFNpemVCeXRlczogMTEyLFxuICBTdHJlYW1WaWV3VHlwZTogJ05FV19BTkRfT0xEX0lNQUdFUycsXG59O1xuXG5jb25zdCBjcmVhdGVSZWNvcmQ6IER5bmFtb0RCUmVjb3JkID0ge1xuICBldmVudElEOiAnN2RlMzA0MWRkNzA5YjAyNGFmNmYyOWU0ZmExM2QzNGMnLFxuICBldmVudE5hbWU6ICdJTlNFUlQnLFxuICBldmVudFZlcnNpb246ICcxLjEnLFxuICBldmVudFNvdXJjZTogJ2F3czpkeW5hbW9kYicsXG4gIGF3c1JlZ2lvbjogJ3VzLXdlc3QtMicsXG4gIGR5bmFtb2RiOiBob3RBcnJpdmVkQ2FyZ29JbXBvcnQsXG4gIGV2ZW50U291cmNlQVJOOiBgYXJuOmF3czpkeW5hbW9kYjpyZWdpb246MTIzNDU2Nzg5MDEyOnRhYmxlL1ZlaGljbGVzL3N0cmVhbS8yMDE2LTExLTE2VDIwOjQyOjQ4LjEwNGAsXG59O1xuXG5jb25zdCBjcmVhdGVSZWNvcmREYXRhOiBEeW5hbW9EQlJlY29yZCA9IHtcbiAgZXZlbnRJRDogJzdkZTMwNDFkZDcwOWIwMjRhZjZmMjllNGZhMTNkMzRjJyxcbiAgZXZlbnROYW1lOiAnSU5TRVJUJyxcbiAgZXZlbnRWZXJzaW9uOiAnMS4xJyxcbiAgZXZlbnRTb3VyY2U6ICdhd3M6ZHluYW1vZGInLFxuICBhd3NSZWdpb246ICd1cy13ZXN0LTInLFxuICBkeW5hbW9kYjogY3JlYXRlRGF0YSxcbiAgZXZlbnRTb3VyY2VBUk46IGBhcm46YXdzOmR5bmFtb2RiOnJlZ2lvbjoxMjM0NTY3ODkwMTI6dGFibGUvVmVoaWNsZXMvc3RyZWFtLzIwMTYtMTEtMTZUMjA6NDI6NDguMTA0YCxcbn07XG5cbmNvbnN0IHVwZGF0ZVJlY29yZDogRHluYW1vREJSZWNvcmQgPSB7XG4gIGV2ZW50SUQ6ICc3ZGUzMDQxZGQ3MDliMDI0YWY2ZjI5ZTRmYTEzZDNqcycsXG4gIGV2ZW50TmFtZTogJ01PRElGWScsXG4gIGV2ZW50VmVyc2lvbjogJzEuMScsXG4gIGV2ZW50U291cmNlOiAnYXdzOmR5bmFtb2RiJyxcbiAgYXdzUmVnaW9uOiAndXMtd2VzdC0yJyxcbiAgZHluYW1vZGI6IGNvbGRDYXJnb0ltcG9ydCxcbiAgZXZlbnRTb3VyY2VBUk46IGBhcm46YXdzOmR5bmFtb2RiOnJlZ2lvbjoxMjM0NTY3ODkwMTI6dGFibGUvVmVoaWNsZXMvc3RyZWFtLzIwMTYtMTEtMTZUMjA6NDI6NDguMTA0YCxcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGRvSm9iKCkge1xuICBjb25zdCBkYXRhOiBEeW5hbW9EQlN0cmVhbUV2ZW50ID0ge1xuICAgIFJlY29yZHM6IFtjcmVhdGVSZWNvcmQsIGNyZWF0ZVJlY29yZERhdGEsIHVwZGF0ZVJlY29yZF0sXG4gIH07XG5cbiAgYXdhaXQgaGFuZGxlcihkYXRhKTtcbn1cblxuZG9Kb2IoKTtcbiJdfQ==